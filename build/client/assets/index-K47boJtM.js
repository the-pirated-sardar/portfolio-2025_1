import{r as e,j as X}from"./jsx-runtime-BMrMXMSG.js";import{b as he,u as oe,r as we}from"./image-cK7Yol7S.js";import{W as ye,S as ie,P as ve,a as Me,j as q,c as Re,d as J,k as $,l as Se,M as K,m as U,n as xe,o as be,p as Q,q as Te,r as Ae,s as ee,V as W,t as Ce}from"./three-CjGFJPVA.js";import{a as Pe,c as ke,n as ze}from"./style-CdyozSHa.js";import{r as Le,c as Ee,a as De,t as re,m as Be}from"./three-f4FSUuQw.js";import{M as te}from"./route-B_CwCvKb.js";import{t as je}from"./throttle-BgiUmwhn.js";import{u as ne}from"./use-spring-2oVTzKD3.js";import{a as V}from"./animate-Bt8Sv2Bs.js";import"./components-Dta19ZtI.js";import"./oswald-bg-dark-C-sRVmnq.js";import"./meta-DJqpMUuV.js";import"./config-YH5w3qyB.js";import"./preload-helper-D7HrI6pR.js";import"./decoder-text-CtFIuefh.js";import"./visually-hidden-CreUTIVu.js";import"./section-WIR9c-n7.js";import"./useScrollToHash-BH8nWTg6.js";import"./divider-VR2YzdTk.js";import"./useWindowSize-DlOz3mXe.js";import"./index-C7rQJm6-.js";const Ge="_model_fphsv_2",We="_canvas_fphsv_11",ae={model:Ge,canvas:We},se={Frame:"Frame",Screen:"Screen"},ce={stiffness:40,damping:20,mass:1.4,restSpeed:.001},cr=({models:z,show:R=!0,showDelay:L=0,cameraPosition:h={x:0,y:0,z:8},style:E,className:D,onLoad:_,alt:S,...B})=>{const[x,I]=e.useState(!1),f=e.useRef(),l=e.useRef(),o=e.useRef(),w=e.useRef(),t=e.useRef(),r=e.useRef(),p=e.useRef(),d=e.useRef(),g=e.useRef(),y=e.useRef(),c=e.useRef(),u=e.useRef(),n=e.useRef(),m=e.useRef(),v=e.useRef(),a=e.useRef(),j=e.useRef(),N=he(f,!1,{threshold:.2}),O=oe(),b=ne(0,ce),T=ne(0,ce);e.useEffect(()=>{const{clientWidth:s,clientHeight:i}=f.current;r.current=new ye({canvas:l.current,alpha:!0,antialias:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0}),r.current.setPixelRatio(2),r.current.setSize(s,i),r.current.outputColorSpace=ie,o.current=new ve(36,s/i,.1,100),o.current.position.set(h.x,h.y,h.z),t.current=new Me,w.current=new q,t.current.add(w.current);const M=new Re(16777215,1.2),C=new J(16777215,1.1),P=new J(16777215,.8);P.position.set(-6,2,2),C.position.set(.5,0,.866),v.current=[M,C,P],v.current.forEach(k=>t.current.add(k)),p.current=new q,t.current.add(p.current),p.current.position.set(0,0,-.8),p.current.rotateX(Math.PI/2);const G=512,Y=8,Z=8,ue=1.5,le=.8,pe=3;d.current=new $(G,G),d.current.texture.generateMipmaps=!1,g.current=new $(G,G),g.current.texture.generateMipmaps=!1;const H=new Se(Y,Z).rotateX(Math.PI/2),de=new K({map:d.current.texture,opacity:le,transparent:!0});m.current=new U(H,de),m.current.scale.y=-1,p.current.add(m.current),a.current=new U(H),a.current.visible=!1,p.current.add(a.current);const me=new K({color:16777215,opacity:0,transparent:!0});j.current=new U(H,me),j.current.rotateX(Math.PI),j.current.position.y-=1e-5,p.current.add(j.current),y.current=new xe(-8/2,Y/2,Z/2,-8/2,0,ue),y.current.rotation.x=Math.PI/2,p.current.add(y.current),c.current=new be,c.current.userData.darkness={value:pe},c.current.onBeforeCompile=k=>{k.uniforms.darkness=c.current.userData.darkness,k.fragmentShader=`
        uniform float darkness;
        ${k.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * darkness );")}
      `},c.current.depthTest=!1,c.current.depthWrite=!1,u.current=new Q(Te),u.current.depthTest=!1,n.current=new Q(Ae),n.current.depthTest=!1;const fe=b.on("change",A),ge=T.on("change",A);return()=>{d.current.dispose(),g.current.dispose(),Le(v.current),Ee(t.current),De(r.current),fe(),ge()}},[]);const F=e.useCallback(s=>{a.current.visible=!0,a.current.material=u.current,a.current.material.uniforms.tDiffuse.value=d.current.texture,u.current.uniforms.h.value=s*(1/256),r.current.setRenderTarget(g.current),r.current.render(a.current,y.current),a.current.material=n.current,a.current.material.uniforms.tDiffuse.value=g.current.texture,n.current.uniforms.v.value=s*(1/256),r.current.setRenderTarget(d.current),r.current.render(a.current,y.current),a.current.visible=!1},[]),A=e.useCallback(()=>{const i=t.current.background;t.current.background=null,t.current.overrideMaterial=c.current,r.current.setRenderTarget(d.current),r.current.render(t.current,y.current),t.current.overrideMaterial=null,F(5),F(5*.4),r.current.setRenderTarget(null),t.current.background=i,w.current.rotation.x=b.get(),w.current.rotation.y=T.get(),r.current.render(t.current,o.current)},[F,b,T]);return e.useEffect(()=>{const s=je(i=>{const{innerWidth:M,innerHeight:C}=window,P={x:(i.clientX-M/2)/M,y:(i.clientY-C/2)/C};T.set(P.x/2),b.set(P.y/2)},100);return N&&!O&&window.addEventListener("mousemove",s),()=>{window.removeEventListener("mousemove",s)}},[N,O,b,T]),e.useEffect(()=>{const s=()=>{if(!f.current)return;const{clientWidth:i,clientHeight:M}=f.current;r.current.setSize(i,M),o.current.aspect=i/M,o.current.updateProjectionMatrix(),A()};return window.addEventListener("resize",s),s(),()=>{window.removeEventListener("resize",s)}},[A]),X.jsxs("div",{className:ke(ae.model,D),"data-loaded":x,style:Pe({delay:ze(L)},E),ref:f,role:"img","aria-label":S,...B,children:[X.jsx("canvas",{className:ae.canvas,ref:l}),z.map((s,i)=>X.jsx(_e,{renderer:r,modelGroup:w,show:R,showDelay:L,renderFrame:A,index:i,setLoaded:I,onLoad:_,model:s},JSON.stringify(s.position)))]})},_e=({renderer:z,model:R,modelGroup:L,renderFrame:h,index:E,showDelay:D,setLoaded:_,onLoad:S,show:B})=>{const[x,I]=e.useState(),f=oe(),l=e.createRef();e.useEffect(()=>{const o=async(t,r)=>{t.colorSpace=ie,t.flipY=!1,t.anisotropy=z.current.capabilities.getMaxAnisotropy(),t.generateMipmaps=!1,await z.current.initTexture(t),r.material.color=new ee(16777215),r.material.transparent=!0,r.material.map=t};I({start:async()=>{const{texture:t,position:r,url:p}=R;let d,g;const[y,c]=await Promise.all([await re.loadAsync(t.placeholder),await Be.loadAsync(p)]);L.current.add(c.scene),c.scene.traverse(async n=>{n.material&&(n.material.color=new ee(2039845)),n.name===se.Screen&&(l.current=n.clone(),l.current.material=n.material.clone(),n.parent.add(l.current),l.current.material.opacity=1,l.current.position.z+=.001,o(y,l.current),d=async()=>{const m=await we(t),v=await re.loadAsync(m);await o(v,n),V(1,0,{onUpdate:a=>{l.current.material.opacity=a,h()}})})});const u=new W(r.x,r.y,r.z);return f&&c.scene.position.set(...u.toArray()),R.animation===te.SpringUp&&(g=()=>{const n=new W(u.x,u.y-1,u.z);c.scene.position.set(...n.toArray()),V(n.y,u.y,{type:"spring",delay:(300*E+D)/1e3,stiffness:60,damping:20,mass:1,restSpeed:1e-4,restDelta:1e-4,onUpdate:m=>{c.scene.position.y=m,h()}})}),R.animation===te.LaptopOpen&&(g=()=>{const n=c.scene.children.find(a=>a.name===se.Frame),m=new W(Ce.degToRad(90),0,0),v=new W(0,0,0);return c.scene.position.set(...u.toArray()),n.rotation.set(...m.toArray()),V(m.x,v.x,{type:"spring",delay:(300*E+D+300)/1e3,stiffness:80,damping:20,restSpeed:1e-4,restDelta:1e-4,onUpdate:a=>{n.rotation.x=a,h()}})}),{loadFullResTexture:d,playAnimation:g}}})},[]),e.useEffect(()=>{if(!x||!B)return;let o;const w=async()=>{const{loadFullResTexture:t,playAnimation:r}=await x.start();_(!0),S==null||S(),f||(o=r()),await t(),f&&h()};return e.startTransition(()=>{w()}),()=>{o==null||o.stop()}},[x,B])};export{cr as Model};
